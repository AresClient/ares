package dev.tigr.ares.forge.impl.modules.exploit;

import dev.tigr.ares.core.feature.module.Category;
import dev.tigr.ares.core.feature.module.Module;
import dev.tigr.ares.core.util.render.Color;
import dev.tigr.ares.forge.event.events.player.ChunkLoadEvent;
import dev.tigr.ares.forge.utils.RenderUtils;
import dev.tigr.simpleevents.listener.EventHandler;
import dev.tigr.simpleevents.listener.EventListener;
import net.minecraft.client.renderer.RenderGlobal;
import net.minecraft.util.math.AxisAlignedBB;
import net.minecraft.util.math.BlockPos;
import net.minecraft.world.chunk.Chunk;

import java.util.ArrayList;
import java.util.List;

/**
 * @author Tigermouthbear
 */
@Module.Info(name = "NewChunks", description = "Highlights newly generated chunks", category = Category.EXPLOIT)
public class NewChunks extends Module {
    private static final List<Chunk> chunks = new ArrayList<>();

    @EventHandler
    public EventListener<ChunkLoadEvent> chunkLoadEvent = new EventListener<>(event -> {
        if(!event.getData().isFullChunk()) chunks.add(event.getChunk());
    });

    @Override
    public void onRender3d() {
        RenderUtils.prepare3d();
        chunks.forEach(chunk -> drawChunkBox(chunk, Color.ARES_RED));
        RenderUtils.end3d();
    }

    private void drawChunkBox(Chunk chunk, Color color) {
        //AxisAlignedBB bb = new AxisAlignedBB(chunk.x, 0, chunk.z, chunk.x + 16, 1, chunk.z +16);
        AxisAlignedBB bb = RenderUtils.getBoundingBox(new BlockPos(chunk.getPos().getXStart(), 0, chunk.getPos().getZStart()));
        RenderGlobal.drawSelectionBoundingBox(bb, color.getRed(), color.getGreen(), color.getBlue(), color.getAlpha());
    }
}
